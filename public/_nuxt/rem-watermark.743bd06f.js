import{T as pe,M as ce,H as ue}from"./components.b8cc7c2b.js";import{E as me}from"./index.8f5bc808.js";import{E as he}from"./el-progress.1eae7595.js";import{E as ve}from"./el-input-number.0ca7750e.js";import{E as fe}from"./el-card.5d6d708b.js";import"./base.c054e6db.js";/* empty css                  */import"./el-input.f8350fa5.js";/* empty css                   */import"./el-loading.b1ea91ae.js";import{d as ge,r as s,ac as Se,k as _e,l as ye,q as c,s as m,v as b,m as d,z as A,A as j,B as L,C as N,F as we,x as be,y as xe,_ as Ce}from"./entry.89a8456c.js";import{p as Ee,u as Be,a as ke}from"./constants.0737b991.js";import{C as Ie,s as Me}from"./lamaSetting.c06625bf.js";import{E as ze}from"./index.13bae289.js";import"./index.64d33a3b.js";import"./use-global-config.0787c757.js";import"./use-form-common-props.4add0763.js";import"./index.f8748455.js";import"./error.78e43d3e.js";import"./event.9519ab40.js";import"./index.22b79c03.js";import"./aria.60e0cdc6.js";import"./focus-trap.110fc0b9.js";import"./debounce.17f18a2b.js";import"./index.5eefbf66.js";const F=x=>(be("data-v-5b0bb4b4"),x=x(),xe(),x),Re={style:{width:"90%",margin:"0 auto"}},We={style:{width:"60%",margin:"0 auto","margin-top":"15%"}},Le=F(()=>d("div",{style:{"font-size":"24px",height:"50px"}},"图片水印擦除",-1)),Fe={style:{"margin-top":"10%","font-size":"24px"}},Te=F(()=>d("div",{style:{color:"black"}},"或者拖放一个文件",-1)),Ge={style:{width:"100%",margin:"0 auto","margin-top":"10%","text-align":"center"}},Ue={id:"canvasContainerParent",style:{overflow:"hidden",float:"left",width:"80%",position:"relative","text-align":"center"}},He={id:"canvasContainer",style:{float:"left",width:"95%","transform-origin":"0% 0%","text-align":"center"}},Ve={style:{float:"right",width:"19%",height:"442px",margin:"0 auto"}},Oe={style:{"text-align":"left"}},Ye={class:"slider-demo-block"},De=F(()=>d("span",{class:"demonstration"},"画笔大小",-1)),Pe={style:{"text-align":"left","margin-top":"30px"}},Xe={style:{"text-align":"left","margin-top":"30px"}},Ae="#ffcc00bb",je=ge({__name:"rem-watermark",setup(x){const C=s(!0),$=Se().public.baseURL;s([]);const E=s("none"),y=s(),T=s(-1),G=s(-1),w=s(40),B=s("default"),U=s(),H=s(),f=s([]),u=s([]),V=s(),k=s(),I=s(!1),M=s(),O=s(),q=async t=>{C.value=!1;let e=t.raw;y.value=e;let a=await J(e);const n=document.getElementById("demoCanvas"),r=n.getContext("2d"),l=new Image;l.src=a,l.onload=()=>{V.value=l,n.width=l.width,n.height=l.height,le(l.width),se(),U.value=l.width,H.value=l.height,r.drawImage(l,0,0),k.value=r,n.onmousemove=i=>{if(E.value="block",B.value="none",T.value=i.pageX,G.value=i.pageY,i.buttons===0||!I.value)return;const p=[...f.value];if(p.length!=0)return p[p.length-1].pts.push(Y(i)),f.value=p,D(p),!1},n.onmousedown=i=>{I.value=!0;let p=f.value;return p.push({size:w.value,pts:[Y(i)]}),f.value=p,D(p),!1},n.onmouseup=i=>(I.value=!1,!1),n.onmouseleave=i=>(E.value="none",B.value="default",!1)}},J=t=>new Promise((e,a)=>{let n=new FileReader;n.readAsDataURL(t),n.onload=r=>{e(r.target.result)}});function Y(t){return{x:t.offsetX,y:t.offsetY}}const D=t=>{u.value.length===0?z(V.value,t):z(u.value[u.value.length-1],t)},z=(t,e)=>{let a=k.value;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawImage(t,0,0,U.value,H.value),P(a,e))};function P(t,e,a=Ae){t.strokeStyle=a,t.lineCap="round",t.lineJoin="round",e.forEach(n=>{!(n!=null&&n.pts.length)||!n.size||(t.lineWidth=n.size,t.beginPath(),t.moveTo(n.pts[0].x,n.pts[0].y),n.pts.forEach(r=>t.lineTo(r.x,r.y)),t.stroke())})}const K=async()=>{let t=ze.service({fullscreen:!0}),e=y.value,a=Me,n={x:0,y:0,width:0,height:0},r="",l="",i=-1,p,S=f.value;if(f.value=[],Q([S]),u.value.length>0){const de=u.value[u.value.length-1];e=await ee(de.currentSrc,y.value.name,y.value.type)}let o=M.value.toDataURL(),_;const v=await Z(e,a,n,r,l,i,o,_,p);if(!v)throw new Error("Something went wrong on server side.");const{blob:R,seed:X}=v,W=new Image;await ae(W,R);const ie=[...u.value,W];u.value=ie,z(W,[]),t.close()},Q=t=>{M.value=document.createElement("canvas");let e=k.value,a=M.value;a.width=e==null?void 0:e.canvas.width,a.height=e==null?void 0:e.canvas.height;const n=a.getContext("2d");t.forEach(r=>{P(n,r,"white")})},Z=async(t,e,a,n,r,l,i,p,S)=>{const o=new FormData;o.append("image",t),i!==void 0&&o.append("mask",te(i));const _=e.hdSettings.lama;o.append("ldmSteps",e.ldmSteps.toString()),o.append("ldmSampler",e.ldmSampler.toString()),o.append("zitsWireframe",e.zitsWireframe.toString()),o.append("hdStrategy",_.hdStrategy),o.append("hdStrategyCropMargin",_.hdStrategyCropMargin.toString()),o.append("hdStrategyCropTrigerSize",_.hdStrategyCropTrigerSize.toString()),o.append("hdStrategyResizeLimit",_.hdStrategyResizeLimit.toString()),o.append("prompt",n===void 0?"":n),o.append("negativePrompt",r===void 0?"":r),o.append("croperX",a.x.toString()),o.append("croperY",a.y.toString()),o.append("croperHeight",a.height.toString()),o.append("croperWidth",a.width.toString()),o.append("useCroper",e.showCroper?"true":"false"),o.append("sdMaskBlur",e.sdMaskBlur.toString()),o.append("sdStrength",e.sdStrength.toString()),o.append("sdSteps",e.sdSteps.toString()),o.append("sdGuidanceScale",e.sdGuidanceScale.toString()),o.append("sdSampler",e.sdSampler.toString()),o.append("sdSeed",l?l.toString():"-1"),o.append("sdMatchHistograms",e.sdMatchHistograms?"true":"false"),o.append("sdScale",(e.sdScale/100).toString()),o.append("cv2Radius",e.cv2Radius.toString()),o.append("cv2Flag",e.cv2Flag.toString()),o.append("paintByExampleSteps",e.paintByExampleSteps.toString()),o.append("paintByExampleGuidanceScale",e.paintByExampleGuidanceScale.toString()),o.append("paintByExampleSeed",l?l.toString():"-1"),o.append("paintByExampleMaskBlur",e.paintByExampleMaskBlur.toString()),o.append("paintByExampleMatchHistograms",e.paintByExampleMatchHistograms?"true":"false"),S&&o.append("paintByExampleImage",S),o.append("p2pSteps",e.p2pSteps.toString()),o.append("p2pImageGuidanceScale",e.p2pImageGuidanceScale.toString()),o.append("p2pGuidanceScale",e.p2pGuidanceScale.toString()),o.append("controlnet_conditioning_scale",e.controlnetConditioningScale.toString()),o.append("controlnet_method",Ie[e.controlnetMethod.toString()]);const v=await fetch(`${$}:8080/inpaint`,{method:"POST",body:o});if(v.ok){const R=await v.blob(),X=v.headers.get("x-seed");return{blob:URL.createObjectURL(R),seed:X}}await v.text()};function ee(t,e,a){return fetch(t).then(function(n){return n.arrayBuffer()}).then(function(n){return new File([n],e,{type:a})})}function te(t){const e=t.split(",")[0].split(":")[1].split(";")[0],a=atob(t.split(",")[1]),n=[];for(let r=0;r<a.length;r+=1)n.push(a.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:e})}function ae(t,e){return new Promise((a,n)=>{const r=t.src,l=t;l.onload=a,l.onerror=i=>{l.src=r,n(i)},l.src=e})}const ne=()=>{const t=y.value.name.replace(/(\.[\w\d_-]+)$/i,"_clean$1"),e=u.value[u.value.length-1];oe(e.currentSrc,t)};function oe(t,e){const a=document.createElement("a");a.href=t,a.download=e,a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),setTimeout(()=>{a.remove()},100)}const re=()=>{var t,e;(e=(t=O.value)==null?void 0:t.$.vnode.el)==null||e.click()},g=s(1),h=s(1);s(),s();const le=t=>{document.getElementById("canvasContainer").style.transform="scale(1,1)";let e=document.getElementById("canvasContainer"),a=e.clientWidth||e.offsetWidth;if(t<=a)if(t<200)t=200;else return;let r=a/t;document.getElementById("canvasContainer").style.transform="scale("+r+","+r+")",h.value=r,g.value=r,window.onresize=function(){if(e=document.getElementById("canvasContainer"),a=e.clientWidth||e.offsetWidth,t<=a)if(t<200)t=200;else return;r=a/t,h.value=r,g.value=r,document.getElementById("canvasContainer").style.transform="scale("+r+","+r+")"}},se=()=>{let t=document.getElementById("demoCanvas"),e=1,a=h.value;t.addEventListener("wheel",n=>{n.preventDefault(),e+=n.deltaY>0?-.05:.05,e=Math.min(Math.max(e,1),4),a+=n.deltaY>0?-.05*h.value:.05*h.value,a=Math.min(Math.max(a,h.value),4);const r=parseInt(n.offsetX/t.width*100),l=parseInt(n.offsetY/t.height*100);document.getElementById("demoCanvas").style.transform="scale("+e+","+e+")",document.getElementById("demoCanvas").style.transformOrigin=""+r+"% "+l+"%",h.value<1?g.value=a:g.value=e})};return(t,e)=>{const a=pe,n=ce,r=ue,l=me,i=he,p=ve,S=fe;return _e(),ye(we,null,[c(r,null,{default:m(()=>[c(a,null,{default:m(()=>[b("图片水印去除")]),_:1}),c(n,{name:"description",content:"在线去水印"}),c(n,{name:"keywords",content:"图片,去水印"})]),_:1}),d("div",Re,[A(d("div",We,[Le,d("div",null,[c(i,{class:"upload-demo",drag:"","show-file-list":!1,"auto-upload":!1,onChange:q,accept:".gif,.tif,.tiff,.png,.crw,.cr2,.dng,.raf,.nef,.nrw,.orf,.rw2,.pef,.arw,.srf,.sr2,.raw,.psd,.svg,.webp,.heic,.avif,.jpg,.jpeg"},{default:m(()=>[d("div",Fe,[c(l,{ref_key:"uploadRembgId",ref:O,style:{"font-size":"24px"},type:"primary",round:"",size:"large",icon:L(Ee)},{default:m(()=>[b("上传图片")]),_:1},8,["icon"]),Te])]),_:1})])],512),[[j,C.value]]),A(d("div",Ge,[d("div",Ue,[d("div",He,[d("canvas",{id:"demoCanvas",style:N({border:"1px solid #eeeeee",cursor:B.value}),onContextMenu:"return false"},null,4)]),c(l,{type:"primary",onClick:re,style:{position:"absolute",top:"-35px",right:"2.5%"},icon:L(Be)},{default:m(()=>[b("重新上传")]),_:1},8,["icon"])]),d("div",Ve,[c(S,{class:"box-card"},{default:m(()=>[d("div",Oe,[d("div",Ye,[De,c(p,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),min:5},null,8,["modelValue"])])]),d("div",Pe,[c(l,{color:"#626aef",style:{width:"120px",height:"40px",color:"white","font-size":"20px"},onClick:K},{default:m(()=>[b("开始处理")]),_:1})]),d("div",Xe,[c(l,{color:"#409EFF",icon:L(ke),style:{width:"120px",height:"40px",color:"white","font-size":"20px"},onClick:ne},{default:m(()=>[b("下载")]),_:1},8,["icon"])])]),_:1})])],512),[[j,!C.value]]),d("div",{id:"brushShape",class:"brush-shape",style:N({width:w.value+"px",height:w.value+"px",left:T.value+"px",top:G.value+"px",transform:"scale("+g.value+","+g.value+") translate(-50%, -50%)",transformOrigin:"0% 0%",display:E.value})},null,4)])],64)}}});const St=Ce(je,[["__scopeId","data-v-5b0bb4b4"]]);export{St as default};
