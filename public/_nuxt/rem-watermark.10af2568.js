import{E as pe}from"./index.50b37a87.js";import{E as ce}from"./el-progress.56adb9af.js";import{E as ue}from"./el-input-number.ef55a1e9.js";import{E as me}from"./el-card.5d2c1e2b.js";import"./base.b0a13d53.js";/* empty css                  */import"./el-input.948ae661.js";/* empty css                   */import"./el-loading.56cce6ad.js";import{d as he,r as s,ac as ve,k as fe,l as ge,z as A,A as j,m as d,q as h,s as S,B as L,v as b,C as N,x as Se,y as ye,_ as _e}from"./entry.7321a61b.js";import{p as we,u as xe,a as be}from"./constants.eb0fc12e.js";import{C as Ce,s as Ee}from"./lamaSetting.c06625bf.js";import{E as Be}from"./index.f774654b.js";import"./index.636cfc4c.js";import"./use-global-config.f9c3cc9d.js";import"./use-form-common-props.d48746c9.js";import"./index.f8748455.js";import"./error.78e43d3e.js";import"./event.9519ab40.js";import"./index.35a12d77.js";import"./aria.60e0cdc6.js";import"./focus-trap.3b6a5446.js";import"./debounce.dca621c7.js";import"./index.320bca2d.js";const G=w=>(Se("data-v-1558cc01"),w=w(),ye(),w),ke={style:{width:"90%",margin:"0 auto"}},Ie={style:{width:"60%",margin:"0 auto","margin-top":"15%"}},Me=G(()=>d("div",{style:{"font-size":"24px",height:"50px"}},"图片水印擦除",-1)),ze={style:{"margin-top":"10%","font-size":"24px"}},Re=G(()=>d("div",{style:{color:"black"}},"或者拖放一个文件",-1)),We={style:{width:"100%",margin:"0 auto","margin-top":"10%","text-align":"center"}},Le={id:"canvasContainerParent",style:{overflow:"hidden",float:"left",width:"80%",position:"relative","text-align":"center"}},Ge={id:"canvasContainer",style:{float:"left",width:"95%","transform-origin":"0% 0%","text-align":"center"}},Ue={style:{float:"right",width:"19%",height:"442px",margin:"0 auto"}},Fe={style:{"text-align":"left"}},Ve={class:"slider-demo-block"},Te=G(()=>d("span",{class:"demonstration"},"画笔大小",-1)),Oe={style:{"text-align":"left","margin-top":"30px"}},Ye={style:{"text-align":"left","margin-top":"30px"}},De="#ffcc00bb",He=he({__name:"rem-watermark",setup(w){const C=s(!0),$=ve().public.baseURL;s([]);const E=s("none"),y=s(),U=s(-1),F=s(-1),_=s(40),B=s("default"),V=s(),T=s(),v=s([]),c=s([]),O=s(),k=s(),I=s(!1),M=s(),Y=s(),q=async t=>{C.value=!1;let e=t.raw;y.value=e;let a=await J(e);const n=document.getElementById("demoCanvas"),r=n.getContext("2d"),l=new Image;l.src=a,l.onload=()=>{O.value=l,n.width=l.width,n.height=l.height,le(l.width),se(),V.value=l.width,T.value=l.height,r.drawImage(l,0,0),k.value=r,n.onmousemove=i=>{if(E.value="block",B.value="none",U.value=i.pageX,F.value=i.pageY,i.buttons===0||!I.value)return;const p=[...v.value];if(p.length!=0)return p[p.length-1].pts.push(D(i)),v.value=p,H(p),!1},n.onmousedown=i=>{I.value=!0;let p=v.value;return p.push({size:_.value,pts:[D(i)]}),v.value=p,H(p),!1},n.onmouseup=i=>(I.value=!1,!1),n.onmouseleave=i=>(E.value="none",B.value="default",!1)}},J=t=>new Promise((e,a)=>{let n=new FileReader;n.readAsDataURL(t),n.onload=r=>{e(r.target.result)}});function D(t){return{x:t.offsetX,y:t.offsetY}}const H=t=>{c.value.length===0?z(O.value,t):z(c.value[c.value.length-1],t)},z=(t,e)=>{let a=k.value;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawImage(t,0,0,V.value,T.value),P(a,e))};function P(t,e,a=De){t.strokeStyle=a,t.lineCap="round",t.lineJoin="round",e.forEach(n=>{!(n!=null&&n.pts.length)||!n.size||(t.lineWidth=n.size,t.beginPath(),t.moveTo(n.pts[0].x,n.pts[0].y),n.pts.forEach(r=>t.lineTo(r.x,r.y)),t.stroke())})}const K=async()=>{let t=Be.service({fullscreen:!0}),e=y.value,a=Ee,n={x:0,y:0,width:0,height:0},r="",l="",i=-1,p,x=v.value;if(v.value=[],Q([x]),c.value.length>0){const de=c.value[c.value.length-1];e=await ee(de.currentSrc,y.value.name,y.value.type)}let o=M.value.toDataURL(),g;const m=await Z(e,a,n,r,l,i,o,g,p);if(!m)throw new Error("Something went wrong on server side.");const{blob:R,seed:X}=m,W=new Image;await ae(W,R);const ie=[...c.value,W];c.value=ie,z(W,[]),t.close()},Q=t=>{M.value=document.createElement("canvas");let e=k.value,a=M.value;a.width=e==null?void 0:e.canvas.width,a.height=e==null?void 0:e.canvas.height;const n=a.getContext("2d");t.forEach(r=>{P(n,r,"white")})},Z=async(t,e,a,n,r,l,i,p,x)=>{const o=new FormData;o.append("image",t),i!==void 0&&o.append("mask",te(i));const g=e.hdSettings.lama;o.append("ldmSteps",e.ldmSteps.toString()),o.append("ldmSampler",e.ldmSampler.toString()),o.append("zitsWireframe",e.zitsWireframe.toString()),o.append("hdStrategy",g.hdStrategy),o.append("hdStrategyCropMargin",g.hdStrategyCropMargin.toString()),o.append("hdStrategyCropTrigerSize",g.hdStrategyCropTrigerSize.toString()),o.append("hdStrategyResizeLimit",g.hdStrategyResizeLimit.toString()),o.append("prompt",n===void 0?"":n),o.append("negativePrompt",r===void 0?"":r),o.append("croperX",a.x.toString()),o.append("croperY",a.y.toString()),o.append("croperHeight",a.height.toString()),o.append("croperWidth",a.width.toString()),o.append("useCroper",e.showCroper?"true":"false"),o.append("sdMaskBlur",e.sdMaskBlur.toString()),o.append("sdStrength",e.sdStrength.toString()),o.append("sdSteps",e.sdSteps.toString()),o.append("sdGuidanceScale",e.sdGuidanceScale.toString()),o.append("sdSampler",e.sdSampler.toString()),o.append("sdSeed",l?l.toString():"-1"),o.append("sdMatchHistograms",e.sdMatchHistograms?"true":"false"),o.append("sdScale",(e.sdScale/100).toString()),o.append("cv2Radius",e.cv2Radius.toString()),o.append("cv2Flag",e.cv2Flag.toString()),o.append("paintByExampleSteps",e.paintByExampleSteps.toString()),o.append("paintByExampleGuidanceScale",e.paintByExampleGuidanceScale.toString()),o.append("paintByExampleSeed",l?l.toString():"-1"),o.append("paintByExampleMaskBlur",e.paintByExampleMaskBlur.toString()),o.append("paintByExampleMatchHistograms",e.paintByExampleMatchHistograms?"true":"false"),x&&o.append("paintByExampleImage",x),o.append("p2pSteps",e.p2pSteps.toString()),o.append("p2pImageGuidanceScale",e.p2pImageGuidanceScale.toString()),o.append("p2pGuidanceScale",e.p2pGuidanceScale.toString()),o.append("controlnet_conditioning_scale",e.controlnetConditioningScale.toString()),o.append("controlnet_method",Ce[e.controlnetMethod.toString()]);const m=await fetch(`${$}:8080/inpaint`,{method:"POST",body:o});if(m.ok){const R=await m.blob(),X=m.headers.get("x-seed");return{blob:URL.createObjectURL(R),seed:X}}await m.text()};function ee(t,e,a){return fetch(t).then(function(n){return n.arrayBuffer()}).then(function(n){return new File([n],e,{type:a})})}function te(t){const e=t.split(",")[0].split(":")[1].split(";")[0],a=atob(t.split(",")[1]),n=[];for(let r=0;r<a.length;r+=1)n.push(a.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:e})}function ae(t,e){return new Promise((a,n)=>{const r=t.src,l=t;l.onload=a,l.onerror=i=>{l.src=r,n(i)},l.src=e})}const ne=()=>{const t=y.value.name.replace(/(\.[\w\d_-]+)$/i,"_clean$1"),e=c.value[c.value.length-1];oe(e.currentSrc,t)};function oe(t,e){const a=document.createElement("a");a.href=t,a.download=e,a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),setTimeout(()=>{a.remove()},100)}const re=()=>{var t,e;(e=(t=Y.value)==null?void 0:t.$.vnode.el)==null||e.click()},f=s(1),u=s(1);s(),s();const le=t=>{document.getElementById("canvasContainer").style.transform="scale(1,1)";let e=document.getElementById("canvasContainer"),a=e.clientWidth||e.offsetWidth;if(t<=a)if(t<200)t=200;else return;let r=a/t;document.getElementById("canvasContainer").style.transform="scale("+r+","+r+")",u.value=r,f.value=r,window.onresize=function(){if(e=document.getElementById("canvasContainer"),a=e.clientWidth||e.offsetWidth,t<=a)if(t<200)t=200;else return;r=a/t,u.value=r,f.value=r,document.getElementById("canvasContainer").style.transform="scale("+r+","+r+")"}},se=()=>{let t=document.getElementById("demoCanvas"),e=1,a=u.value;t.addEventListener("wheel",n=>{n.preventDefault(),e+=n.deltaY>0?-.05:.05,e=Math.min(Math.max(e,1),4),a+=n.deltaY>0?-.05*u.value:.05*u.value,a=Math.min(Math.max(a,u.value),4);const r=parseInt(n.offsetX/t.width*100),l=parseInt(n.offsetY/t.height*100);document.getElementById("demoCanvas").style.transform="scale("+e+","+e+")",document.getElementById("demoCanvas").style.transformOrigin=""+r+"% "+l+"%",u.value<1?f.value=a:f.value=e})};return(t,e)=>{const a=pe,n=ce,r=ue,l=me;return fe(),ge("div",ke,[A(d("div",Ie,[Me,d("div",null,[h(n,{class:"upload-demo",drag:"","show-file-list":!1,"auto-upload":!1,onChange:q,accept:".gif,.tif,.tiff,.png,.crw,.cr2,.dng,.raf,.nef,.nrw,.orf,.rw2,.pef,.arw,.srf,.sr2,.raw,.psd,.svg,.webp,.heic,.avif,.jpg,.jpeg"},{default:S(()=>[d("div",ze,[h(a,{ref_key:"uploadRembgId",ref:Y,style:{"font-size":"24px"},type:"primary",round:"",size:"large",icon:L(we)},{default:S(()=>[b("上传图片")]),_:1},8,["icon"]),Re])]),_:1})])],512),[[j,C.value]]),A(d("div",We,[d("div",Le,[d("div",Ge,[d("canvas",{id:"demoCanvas",style:N({border:"1px solid #eeeeee",cursor:B.value}),onContextMenu:"return false"},null,4)]),h(a,{type:"primary",onClick:re,style:{position:"absolute",top:"-35px",right:"2.5%"},icon:L(xe)},{default:S(()=>[b("重新上传")]),_:1},8,["icon"])]),d("div",Ue,[h(l,{class:"box-card"},{default:S(()=>[d("div",Fe,[d("div",Ve,[Te,h(r,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=i=>_.value=i),min:5},null,8,["modelValue"])])]),d("div",Oe,[h(a,{color:"#626aef",style:{width:"120px",height:"40px",color:"white","font-size":"20px"},onClick:K},{default:S(()=>[b("开始处理")]),_:1})]),d("div",Ye,[h(a,{color:"#409EFF",icon:L(be),style:{width:"120px",height:"40px",color:"white","font-size":"20px"},onClick:ne},{default:S(()=>[b("下载")]),_:1},8,["icon"])])]),_:1})])],512),[[j,!C.value]]),d("div",{id:"brushShape",class:"brush-shape",style:N({width:_.value+"px",height:_.value+"px",left:U.value+"px",top:F.value+"px",transform:"scale("+f.value+","+f.value+") translate(-50%, -50%)",transformOrigin:"0% 0%",display:E.value})},null,4)])}}});const mt=_e(He,[["__scopeId","data-v-1558cc01"]]);export{mt as default};
