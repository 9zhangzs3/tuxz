import{T as De,M as He,H as Me}from"./components.b8cc7c2b.js";import{E as Oe}from"./index.8f5bc808.js";import{E as Le,a as Te}from"./el-progress.1eae7595.js";import{B as je,E as Ae,a as Ne,b as Fe}from"./beforafter.d49990a2.js";import{E as $e}from"./el-switch.d159257d.js";import{E as Ge,a as Je}from"./el-radio-group.65868cc8.js";import{E as Ke,p as de,d as Ze,a as qe}from"./constants.0737b991.js";import{E as Qe}from"./el-card.5d6d708b.js";import{_ as Xe}from"./client-only.80bd0e48.js";import{E as Ye}from"./el-overlay.07b01796.js";import"./base.c054e6db.js";/* empty css                  *//* empty css                   */import"./el-scrollbar.41fb776b.js";/* empty css                */import"./el-loading.b1ea91ae.js";import{d as et,r as n,o as tt,k as at,l as lt,q as i,s as d,v as h,m as l,z as m,A as p,B as P,t as g,C as A,F as ot,D as st,x as nt,y as it,_ as ut}from"./entry.89a8456c.js";import{J as rt,F as dt}from"./FileSaver.min.8ad78cd6.js";import{E as N}from"./index.13bae289.js";import"./index.64d33a3b.js";import"./use-global-config.0787c757.js";import"./use-form-common-props.4add0763.js";import"./index.f8748455.js";import"./error.78e43d3e.js";import"./index.22b79c03.js";import"./aria.60e0cdc6.js";import"./focus-trap.110fc0b9.js";import"./_commonjsHelpers.042e6b4d.js";import"./debounce.17f18a2b.js";import"./event.9519ab40.js";import"./index.1ed0807d.js";import"./vnode.76be746b.js";import"./scroll.58f66198.js";const _=k=>(nt("data-v-707df46d"),k=k(),it(),k),ct={style:{width:"90%",margin:"0 auto"}},vt={style:{width:"60%",margin:"0 auto","margin-top":"15%"}},mt=_(()=>l("div",{style:{"font-size":"24px",height:"50px"}},"动漫图片清晰度修复",-1)),pt={style:{"margin-top":"10%","font-size":"24px"}},ht=_(()=>l("div",{style:{color:"black"}},"或者拖放多个文件",-1)),gt={style:{width:"100%",margin:"0 auto","margin-top":"10%"}},_t={style:{float:"left",height:"500px",width:"70%"}},ft={style:{overflow:"hidden",display:"inline-block","max-width":"180px","white-space":"nowrap","text-overflow":"ellipsis",title:"center"}},wt={style:{display:"flex","align-items":"center"}},bt={style:{display:"flex","align-items":"center"}},yt={style:{display:"flex","align-items":"center"}},xt={style:{"text-align":"right"}},Et={style:{"text-align":"center"}},It={style:{float:"right",width:"25%",height:"442px",margin:"0 auto"}},zt={style:{height:"400px","margin-top":"20px"}},Ct={class:"slider-demo-block"},kt={class:"slider-demo-block"},Rt=_(()=>l("div",{style:{height:"20px"}},null,-1)),Bt=_(()=>l("br",null,null,-1)),St=_(()=>l("div",{style:{height:"15px"}},null,-1)),Ut={class:"mainSection"},Vt=["src"],Wt=_(()=>l("div",{class:"bal-afterPosition afterLabel"},"处理后",-1)),Pt={class:"bal-before"},Dt=["src"],Ht=_(()=>l("div",{class:"bal-beforePosition beforeLabel"},"处理前",-1)),Mt=_(()=>l("div",{class:"bal-handle"},[l("span",{class:"handle-left-arrow"}),l("span",{class:"handle-right-arrow"})],-1)),Ot=_(()=>l("div",{style:{display:"none"}},[l("canvas",{id:"canvas-upload"}),l("canvas",{id:"canvas-output"})],-1)),Lt=et({__name:"animesr",setup(k){n(!0);const D=n(!0),F=n(),a=n([]);n(73);const H=n(!1),$=n(),G=n(),f=n(0),w=n("100%"),M=n("80%"),O=n(0),R=n(),b=n(!0),L=n("2"),T=n("3"),x=n(!1);let E=null,y=null;var B=null;const J=n(0),K=n(0),j=n(),Z=n(!1),q=n(!1),ce=n(50),S=n(0),Q=n(0),X=n(0),ve=n(2),U=n(0),Y=n(0),ee=n(0),te=n(-1),ae=n(0),le=n(!0),V=n(),r=n(0),oe=n();tt(function(){fetch("https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/worker/realcugan-ncnn-webassembly-simd-threads.worker.js").then(t=>t.text()).then(t=>{const e=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(e);oe.value=s,B={print:u=>{console.log("print",u),u.length>11&&u.substring(0,10)==="$CALLBACK$"&&he(u.substring(11,u.length))},printErr:u=>{console.log("err",u)}},fe()})});const W=t=>{let e=document.getElementById("canvas-upload"),s=e.getContext("2d"),u=new FileReader;u.onload=v=>{let c=new Image;c.onload=()=>{e.width=c.width,e.height=c.height,s.drawImage(c,0,0),J.value=c.width,K.value=c.height,a.value[r.value].originalImageWidth||(a.value[r.value].originalImageWidth=c.width,a.value[r.value].originalImageHeight=c.height),a.value[r.value].beforeImageWidth=c.width,a.value[r.value].beforeImageHeight=c.height,a.value[r.value].sizeRadio=L.value,a.value[r.value].isSuccess=!1;let I=s.getImageData(0,0,e.width,e.height);me(I,e.width,e.height)},c.src=v.target.result},u.readAsDataURL(t)},me=(t,e,s)=>{let u=document.getElementById("canvas-output");u.getContext("2d"),j.value="正在加载资源...",Z.value=!0,q.value=!1,ce.value=50,S.value=0,Q.value=0,X.value=0,te.value=T.value,U.value=ve.value,ae.value=te.value,Y.value=J.value*U.value,ee.value=K.value*U.value,u.width=Y.value,u.height=ee.value;let v=document.getElementById("canvas-output"),c=v.getContext("2d");E=_malloc(t.data.length),HEAPU8.set(t.data,E);let I=c.getImageData(0,0,v.width,v.height);y=_malloc(I.data.length),_process_image(0,E,y,e,s,U.value,ae.value)!==0&&console.log("请稍后再试,调用冲突")},pe=()=>le.value?!1:(console.log("正在努力加载资源中(约12MB)，请稍后再试"),!0),he=t=>{try{let e=JSON.parse(t);switch(e.eventType){case"PROC_END":_e(e.cost);break;case"PROC_PROGRESS":ge(e.total_cost,e.tile_cost,e.progress_rate,e.remaining_time)}}catch(e){console.error("wasmCallback parse error:",e)}},ge=(t,e,s,u)=>{j.value="本地CPU努力处理中......",S.value=Math.ceil(s*50),a.value[r.value].reReal?a.value[r.value].progressRate=50+S.value:a.value[r.value].progressRate=S.value,Q.value=t,X.value=Math.round(u/1e3)},_e=t=>{let e=document.getElementById("canvas-output"),s=e.getContext("2d");a.value[r.value].imageWidth=e.width,a.value[r.value].imageHeight=e.height;let u=s.getImageData(0,0,e.width,e.height),v=HEAPU8.subarray(y,y+u.data.length);u.data.set(v),s.putImageData(u,0,0),V.value=e.toDataURL(),a.value[r.value].compressBase64=V.value,a.value[r.value].compressSize=se(V.value.length),a.value[r.value].handleBlob=xe(V.value),a.value[r.value].afterUrl=Ee(a.value[r.value].handleBlob),_free(E),_free(y),E=null,y=null,Z.value=!1,q.value=!0;let c=Math.round(t/1e3);t<1e3&&(c=(t/1e3).toFixed(2)),j.value="处理完成！耗时: "+c+"秒",a.value[r.value].costNum+=c,a.value[r.value].sizeRadio=="4"&&a.value[r.value].originalImageWidth*a.value[r.value].sizeRadio>e.width?(a.value[r.value].reReal=!0,W(a.value[r.value].handleBlob)):(a.value[r.value].isSuccess=!0,r.value++,r.value<=a.value.length-1?W(a.value[r.value].raw):x.value=!1)},fe=()=>{fetch("https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/wasm/realcugan-ncnn-webassembly-simd-threads.wasm").then(t=>{t.arrayBuffer()}).then(t=>{B.wasmBinary=t;let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/worker/initRealCuganModule-V1.js",e.onload=()=>{setModule(B,oe.value);let s=document.createElement("script");s.src="https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/worker/realcugan-ncnn-webassembly-simd-threads-V2.js",s.onload=()=>{console.log("Emscripten loaded.")},document.body.appendChild(s)},document.body.appendChild(e),B.onRuntimeInitialized=()=>{console.log("wasm module loaded"),le.value=!0}})},we=async(t,e)=>{R.value||(R.value=N.service({lock:!0,text:"正在加载图片...",background:"rgba(0, 0, 0, 0.7)"}));let s=e.length;O.value=Math.max(s,O.value),setTimeout(()=>{if(s===O.value){D.value=!1;for(let u=a.value.length;u<e.length;u++)t=e[u],ze.value+=t.size,a.value.push({url:t.url,name:t.raw.name,size:t.size,raw:t.raw,type:t.raw.type,compressSize:"-",index:a.value.length-1,flag:!1,costNum:0});R.value.close(),R.value=null}},1)},se=function(t){var e="";t<.1*1024?e=t.toFixed(2)+" B":t<.1*1024*1024?e=(t/1024).toFixed(2)+" KB":t<.1*1024*1024*1024?e=(t/(1024*1024)).toFixed(2)+" MB":e=(t/(1024*1024*1024)).toFixed(2)+" GB";var s=e+"",u=s.indexOf("."),v=s.substr(u+1,2);return v=="00"?s.substring(0,u)+s.substr(u+3,2):s},be=()=>{var t,e;(e=(t=F.value)==null?void 0:t.$.vnode.el)==null||e.click()};async function ye(){if(pe()){console.log("未准备好");return}r.value=0;for(let e=0;e<a.value.length;e++)a.value[e].isSuccess=!1,a.value[e].reReal=!1,a.value[e].progressRate=0,a.value[e].costNum=0;const t=N.service({lock:!0,background:"rgba(0, 0, 0, 0.7)"});t.setText("0/"+a.value.length),x.value=!0,W(a.value[r.value].raw),t.close()}function xe(t){for(var e=t.split(","),s=e[0].match(/:(.*?);/)[1],u=atob(e[1]),v=u.length,c=new Uint8Array(v);v--;)c[v]=u.charCodeAt(v);return new Blob([c],{type:s})}function Ee(t){return window.URL.createObjectURL(t)}const Ie=t=>{const e=document.createElement("a");e.href=a.value[t].compressBase64,e.download=a.value[t].name,e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),setTimeout(()=>{e.remove()},100)},ze=n(0),Ce=t=>{H.value=!0,f.value=0,M.value="80%",st(()=>{new je({id:"#one"}),w.value="100%",$.value=a.value[t].url,G.value=a.value[t].afterUrl;let e=document.getElementsByClassName("mainSection")[0];if(a.value[t].imageWidth<e.offsetWidth)f.value=a.value[t].imageHeight,w.value=a.value[t].imageWidth+"px",M.value=a.value[t].imageWidth+50+"px";else{let s=e.offsetWidth*(a.value[t].imageHeight/a.value[t].imageWidth);f.value=s,w.value=e.offsetWidth+"px"}})},ke=()=>{if(a.value.length==0)return;const t=N.service({lock:!0,text:"正在打包...",background:"rgba(0, 0, 0, 0.7)"});let e=new rt;for(let s=0;s<a.value.length;s++)e.file(a.value[s].name,Re(a.value[s].compressBase64),{base64:!0});e.generateAsync({type:"blob"}).then(function(s){dt.saveAs(s,"图片.zip")}),t.close()},Re=t=>{var e=t.split(",");return e[1]};return(t,e)=>{const s=De,u=He,v=Me,c=Oe,I=Le,ne=Ae,z=Ne,Be=Te,Se=Fe,ie=$e,C=Ge,ue=Je,re=Ke,Ue=Qe,Ve=Xe,We=Ye;return at(),lt(ot,null,[i(v,null,{default:d(()=>[i(s,null,{default:d(()=>[h("动漫图片清晰度修复")]),_:1}),i(u,{name:"description",content:"动漫图片清晰度修复"}),i(u,{name:"keywords",content:"动漫,图像,修复,放大,清晰,图片变清晰,图片修复,无损放大"})]),_:1}),l("div",ct,[m(l("div",vt,[mt,l("div",null,[i(I,{class:"upload-demo",drag:"","list-type":"picture-card","show-file-list":!1,"auto-upload":!1,onChange:we,multiple:"true",accept:".gif,.png,.webp,.avif,.jpg,.jpeg"},{default:d(()=>[l("div",pt,[i(c,{ref_key:"uploadId",ref:F,style:{"font-size":"24px"},type:"primary",round:"",size:"large",icon:P(de)},{default:d(()=>[h("上传多个图片")]),_:1},8,["icon"]),ht])]),_:1})])],512),[[p,D.value]]),m(l("div",gt,[l("div",_t,[i(Se,{data:a.value,height:"600"},{default:d(()=>[i(z,{label:"文件名","min-width":"140"},{default:d(o=>[i(ne,{effect:"light",trigger:"hover",placement:"right",width:"auto"},{default:d(()=>[l("div",null,g(o.row.name),1)]),reference:d(()=>[l("span",ft,g(o.row.name),1)]),_:2},1024)]),_:1}),i(z,{label:"原尺寸","min-width":"120"},{default:d(o=>[l("div",wt,[m(l("span",null,"-",512),[[p,!o.row.originalImageWidth]]),m(l("span",{style:{"font-size":"12px"}},g(o.row.originalImageWidth)+"x"+g(o.row.originalImageHeight)+"px | "+g(se(o.row.size)),513),[[p,o.row.originalImageWidth]])])]),_:1}),i(z,{label:"处理后尺寸","min-width":"120"},{default:d(o=>[l("div",bt,[m(l("span",null,"-",512),[[p,!o.row.isSuccess]]),m(l("span",{style:{"font-size":"12px"}},g(o.row.originalImageWidth*o.row.sizeRadio)+"x"+g(o.row.originalImageHeight*o.row.sizeRadio)+"px | "+g(o.row.compressSize),513),[[p,o.row.isSuccess]])])]),_:1}),i(z,{label:"耗时","min-width":"100"},{default:d(o=>[l("div",yt,[m(l("span",null,"-",512),[[p,!o.row.isSuccess]]),m(l("span",null,g(o.row.costNum)+"秒",513),[[p,o.row.isSuccess]])])]),_:1}),i(z,{align:"right","min-width":"120"},{header:d(()=>[l("div",xt,[i(c,{type:"",text:"",onClick:be,icon:P(de)},{default:d(()=>[h("添加更多图片")]),_:1},8,["icon"])])]),default:d(o=>[m(l("span",Et,[i(Be,{percentage:o.row.progressRate},null,8,["percentage"])],512),[[p,!o.row.isSuccess]]),m(i(c,{size:"small",onClick:Pe=>Ce(o.$index,o.row)},{default:d(()=>[h("查看")]),_:2},1032,["onClick"]),[[p,o.row.isSuccess]]),m(i(c,{size:"small",type:"danger",onClick:Pe=>Ie(o.$index,o.row)},{default:d(()=>[h("下载")]),_:2},1032,["onClick"]),[[p,o.row.isSuccess]])]),_:1})]),_:1},8,["data"])]),i(Ve,null,{default:d(()=>[l("div",It,[l("div",zt,[i(Ue,{shadow:"always"},{default:d(()=>[i(ie,{"active-text":"尺寸",disabled:"",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o)},null,8,["modelValue"]),m(l("div",Ct,[i(ue,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=o=>L.value=o)},{default:d(()=>[i(C,{label:"2"},{default:d(()=>[h("2倍")]),_:1}),i(C,{label:"4"},{default:d(()=>[h("4倍")]),_:1})]),_:1},8,["modelValue"])],512),[[p,b.value]]),i(ie,{"active-text":"画质",disabled:"",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o)},null,8,["modelValue"]),m(l("div",kt,[i(ue,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=o=>T.value=o)},{default:d(()=>[i(C,{label:"-1"},{default:d(()=>[h("保守")]),_:1}),i(C,{label:"0"},{default:d(()=>[h("平衡")]),_:1}),i(C,{label:"3"},{default:d(()=>[h("高级")]),_:1})]),_:1},8,["modelValue"])],512),[[p,b.value]]),Rt,i(c,{onClick:ye,disabled:x.value,type:"success",style:{width:"100%"},size:"large"},{default:d(()=>[h("开始处理"),i(re,{class:"el-icon--right"},{default:d(()=>[i(P(Ze))]),_:1})]),_:1},8,["disabled"]),Bt,St,i(c,{onClick:ke,disabled:x.value,type:"primary",style:{width:"100%"},size:"large"},{default:d(()=>[h("打包下载 "),i(re,{class:"el-icon--right"},{default:d(()=>[i(P(qe))]),_:1})]),_:1},8,["disabled"])]),_:1})])])]),_:1})],512),[[p,!D.value]])]),i(We,{"open-delay":"","append-to-body":"",modelValue:H.value,"onUpdate:modelValue":e[4]||(e[4]=o=>H.value=o),width:M.value,"align-center":"",center:""},{default:d(()=>[l("div",Ut,[l("div",{id:"one",style:A({height:f.value+"px",width:w.value}),class:"bal-container"},[l("div",{style:A({height:f.value+"px",width:w.value}),class:"bal-after"},[l("img",{src:G.value},null,8,Vt),Wt],4),l("div",Pt,[l("div",{style:A({height:f.value+"px",width:w.value}),class:"bal-before-inset"},[l("img",{id:"afterImageId",src:$.value},null,8,Dt),Ht],4)]),Mt],4)])]),_:1},8,["modelValue","width"]),Ot],64)}}});const wa=ut(Lt,[["__scopeId","data-v-707df46d"]]);export{wa as default};
