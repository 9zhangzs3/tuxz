import{E as Ve}from"./index.5fe7711e.js";import{E as We,a as Pe}from"./el-progress.1e2c2aec.js";import{B as De,E as Oe,a as Le,b as je}from"./beforafter.51c7d4ba.js";import{E as Ae}from"./el-switch.4cf1ce21.js";import{E as He,a as Me}from"./el-radio-group.b75c4c4b.js";import{E as Ne,p as re,d as Te,a as Fe}from"./constants.32292d8d.js";import{E as $e}from"./el-card.a0645fe2.js";import{_ as Ge}from"./client-only.5718a18c.js";import{E as Je}from"./el-overlay.35552634.js";import"./base.c3d2e3d9.js";/* empty css                  *//* empty css                   */import"./el-scrollbar.41fb776b.js";/* empty css                */import"./el-loading.4998970f.js";import{d as Ke,r as n,o as Ze,k as qe,l as Qe,m as l,z as m,A as h,q as r,s as d,B as W,v as p,t as g,C as M,F as Xe,D as Ye,x as et,y as tt,_ as at}from"./entry.1dc6e359.js";import{J as lt,F as ot}from"./FileSaver.min.8ad78cd6.js";import{E as N}from"./index.55621d2c.js";import"./index.901f8d30.js";import"./use-global-config.5035f634.js";import"./use-form-common-props.197ce949.js";import"./index.f8748455.js";import"./error.78e43d3e.js";import"./index.f0a79751.js";import"./aria.60e0cdc6.js";import"./focus-trap.8aa43648.js";import"./_commonjsHelpers.042e6b4d.js";import"./debounce.72c54a3b.js";import"./event.9519ab40.js";import"./index.b9606ab9.js";import"./vnode.edf20a27.js";import"./scroll.9c3d5e4c.js";const _=C=>(et("data-v-87114bc5"),C=C(),tt(),C),st={style:{width:"90%",margin:"0 auto"}},nt={style:{width:"60%",margin:"0 auto","margin-top":"15%"}},it=_(()=>l("div",{style:{"font-size":"24px",height:"50px"}},"动漫图片清晰度修复",-1)),ut={style:{"margin-top":"10%","font-size":"24px"}},rt=_(()=>l("div",{style:{color:"black"}},"或者拖放多个文件",-1)),dt={style:{width:"100%",margin:"0 auto","margin-top":"10%"}},ct={style:{float:"left",height:"500px",width:"70%"}},vt={style:{overflow:"hidden",display:"inline-block","max-width":"180px","white-space":"nowrap","text-overflow":"ellipsis",title:"center"}},mt={style:{display:"flex","align-items":"center"}},ht={style:{display:"flex","align-items":"center"}},pt={style:{display:"flex","align-items":"center"}},gt={style:{"text-align":"right"}},_t={style:{"text-align":"center"}},ft={style:{float:"right",width:"25%",height:"442px",margin:"0 auto"}},wt={style:{height:"400px","margin-top":"20px"}},bt={class:"slider-demo-block"},yt={class:"slider-demo-block"},xt=_(()=>l("div",{style:{height:"20px"}},null,-1)),Et=_(()=>l("br",null,null,-1)),It=_(()=>l("div",{style:{height:"15px"}},null,-1)),zt={class:"mainSection"},Ct=["src"],Rt=_(()=>l("div",{class:"bal-afterPosition afterLabel"},"处理后",-1)),kt={class:"bal-before"},Bt=["src"],St=_(()=>l("div",{class:"bal-beforePosition beforeLabel"},"处理前",-1)),Ut=_(()=>l("div",{class:"bal-handle"},[l("span",{class:"handle-left-arrow"}),l("span",{class:"handle-right-arrow"})],-1)),Vt=_(()=>l("div",{style:{display:"none"}},[l("canvas",{id:"canvas-upload"}),l("canvas",{id:"canvas-output"})],-1)),Wt=Ke({__name:"animesr",setup(C){n(!0);const P=n(!0),T=n(),a=n([]);n(73);const D=n(!1),F=n(),$=n(),f=n(0),w=n("100%"),O=n("80%"),L=n(0),R=n(),b=n(!0),j=n("2"),A=n("3"),x=n(!1);let E=null,y=null;var k=null;const G=n(0),J=n(0),H=n(),K=n(!1),Z=n(!1),de=n(50),B=n(0),q=n(0),Q=n(0),ce=n(2),S=n(0),X=n(0),Y=n(0),ee=n(-1),te=n(0),ae=n(!0),U=n(),i=n(0),le=n();Ze(function(){fetch("https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/worker/realcugan-ncnn-webassembly-simd-threads.worker.js").then(t=>t.text()).then(t=>{const e=new Blob([t],{type:"text/javascript"}),o=URL.createObjectURL(e);le.value=o,k={print:u=>{console.log("print",u),u.length>11&&u.substring(0,10)==="$CALLBACK$"&&he(u.substring(11,u.length))},printErr:u=>{console.log("err",u)}},_e()})});const V=t=>{let e=document.getElementById("canvas-upload"),o=e.getContext("2d"),u=new FileReader;u.onload=v=>{let c=new Image;c.onload=()=>{e.width=c.width,e.height=c.height,o.drawImage(c,0,0),G.value=c.width,J.value=c.height,a.value[i.value].originalImageWidth||(a.value[i.value].originalImageWidth=c.width,a.value[i.value].originalImageHeight=c.height),a.value[i.value].beforeImageWidth=c.width,a.value[i.value].beforeImageHeight=c.height,a.value[i.value].sizeRadio=j.value,a.value[i.value].isSuccess=!1;let I=o.getImageData(0,0,e.width,e.height);ve(I,e.width,e.height)},c.src=v.target.result},u.readAsDataURL(t)},ve=(t,e,o)=>{let u=document.getElementById("canvas-output");u.getContext("2d"),H.value="正在加载资源...",K.value=!0,Z.value=!1,de.value=50,B.value=0,q.value=0,Q.value=0,ee.value=A.value,S.value=ce.value,te.value=ee.value,X.value=G.value*S.value,Y.value=J.value*S.value,u.width=X.value,u.height=Y.value;let v=document.getElementById("canvas-output"),c=v.getContext("2d");E=_malloc(t.data.length),HEAPU8.set(t.data,E);let I=c.getImageData(0,0,v.width,v.height);y=_malloc(I.data.length),_process_image(0,E,y,e,o,S.value,te.value)!==0&&console.log("请稍后再试,调用冲突")},me=()=>ae.value?!1:(console.log("正在努力加载资源中(约12MB)，请稍后再试"),!0),he=t=>{try{let e=JSON.parse(t);switch(e.eventType){case"PROC_END":ge(e.cost);break;case"PROC_PROGRESS":pe(e.total_cost,e.tile_cost,e.progress_rate,e.remaining_time)}}catch(e){console.error("wasmCallback parse error:",e)}},pe=(t,e,o,u)=>{H.value="本地CPU努力处理中......",B.value=Math.ceil(o*50),a.value[i.value].reReal?a.value[i.value].progressRate=50+B.value:a.value[i.value].progressRate=B.value,q.value=t,Q.value=Math.round(u/1e3)},ge=t=>{let e=document.getElementById("canvas-output"),o=e.getContext("2d");a.value[i.value].imageWidth=e.width,a.value[i.value].imageHeight=e.height;let u=o.getImageData(0,0,e.width,e.height),v=HEAPU8.subarray(y,y+u.data.length);u.data.set(v),o.putImageData(u,0,0),U.value=e.toDataURL(),a.value[i.value].compressBase64=U.value,a.value[i.value].compressSize=oe(U.value.length),a.value[i.value].handleBlob=ye(U.value),a.value[i.value].afterUrl=xe(a.value[i.value].handleBlob),_free(E),_free(y),E=null,y=null,K.value=!1,Z.value=!0;let c=Math.round(t/1e3);t<1e3&&(c=(t/1e3).toFixed(2)),H.value="处理完成！耗时: "+c+"秒",a.value[i.value].costNum+=c,a.value[i.value].sizeRadio=="4"&&a.value[i.value].originalImageWidth*a.value[i.value].sizeRadio>e.width?(a.value[i.value].reReal=!0,V(a.value[i.value].handleBlob)):(a.value[i.value].isSuccess=!0,i.value++,i.value<=a.value.length-1?V(a.value[i.value].raw):x.value=!1)},_e=()=>{fetch("https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/wasm/realcugan-ncnn-webassembly-simd-threads.wasm").then(t=>{t.arrayBuffer()}).then(t=>{k.wasmBinary=t;let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/worker/initRealCuganModule-V1.js",e.onload=()=>{setModule(k,le.value);let o=document.createElement("script");o.src="https://cdn.jsdelivr.net/gh/9zhangzs3/tuxz@main/public/worker/realcugan-ncnn-webassembly-simd-threads-V2.js",o.onload=()=>{console.log("Emscripten loaded.")},document.body.appendChild(o)},document.body.appendChild(e),k.onRuntimeInitialized=()=>{console.log("wasm module loaded"),ae.value=!0}})},fe=async(t,e)=>{R.value||(R.value=N.service({lock:!0,text:"正在加载图片...",background:"rgba(0, 0, 0, 0.7)"}));let o=e.length;L.value=Math.max(o,L.value),setTimeout(()=>{if(o===L.value){P.value=!1;for(let u=a.value.length;u<e.length;u++)t=e[u],Ie.value+=t.size,a.value.push({url:t.url,name:t.raw.name,size:t.size,raw:t.raw,type:t.raw.type,compressSize:"-",index:a.value.length-1,flag:!1,costNum:0});R.value.close(),R.value=null}},1)},oe=function(t){var e="";t<.1*1024?e=t.toFixed(2)+" B":t<.1*1024*1024?e=(t/1024).toFixed(2)+" KB":t<.1*1024*1024*1024?e=(t/(1024*1024)).toFixed(2)+" MB":e=(t/(1024*1024*1024)).toFixed(2)+" GB";var o=e+"",u=o.indexOf("."),v=o.substr(u+1,2);return v=="00"?o.substring(0,u)+o.substr(u+3,2):o},we=()=>{var t,e;(e=(t=T.value)==null?void 0:t.$.vnode.el)==null||e.click()};async function be(){if(me()){console.log("未准备好");return}i.value=0;for(let e=0;e<a.value.length;e++)a.value[e].isSuccess=!1,a.value[e].reReal=!1,a.value[e].progressRate=0,a.value[e].costNum=0;const t=N.service({lock:!0,background:"rgba(0, 0, 0, 0.7)"});t.setText("0/"+a.value.length),x.value=!0,V(a.value[i.value].raw),t.close()}function ye(t){for(var e=t.split(","),o=e[0].match(/:(.*?);/)[1],u=atob(e[1]),v=u.length,c=new Uint8Array(v);v--;)c[v]=u.charCodeAt(v);return new Blob([c],{type:o})}function xe(t){return window.URL.createObjectURL(t)}const Ee=t=>{const e=document.createElement("a");e.href=a.value[t].compressBase64,e.download=a.value[t].name,e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),setTimeout(()=>{e.remove()},100)},Ie=n(0),ze=t=>{D.value=!0,f.value=0,O.value="80%",Ye(()=>{new De({id:"#one"}),w.value="100%",F.value=a.value[t].url,$.value=a.value[t].afterUrl;let e=document.getElementsByClassName("mainSection")[0];if(a.value[t].imageWidth<e.offsetWidth)f.value=a.value[t].imageHeight,w.value=a.value[t].imageWidth+"px",O.value=a.value[t].imageWidth+50+"px";else{let o=e.offsetWidth*(a.value[t].imageHeight/a.value[t].imageWidth);f.value=o,w.value=e.offsetWidth+"px"}})},Ce=()=>{if(a.value.length==0)return;const t=N.service({lock:!0,text:"正在打包...",background:"rgba(0, 0, 0, 0.7)"});let e=new lt;for(let o=0;o<a.value.length;o++)e.file(a.value[o].name,Re(a.value[o].compressBase64),{base64:!0});e.generateAsync({type:"blob"}).then(function(o){ot.saveAs(o,"图片.zip")}),t.close()},Re=t=>{var e=t.split(",");return e[1]};return(t,e)=>{const o=Ve,u=We,v=Oe,c=Le,I=Pe,se=je,ne=Ae,z=He,ie=Me,ue=Ne,ke=$e,Be=Ge,Se=Je;return qe(),Qe(Xe,null,[l("div",st,[m(l("div",nt,[it,l("div",null,[r(u,{class:"upload-demo",drag:"","list-type":"picture-card","show-file-list":!1,"auto-upload":!1,onChange:fe,multiple:"true",accept:".gif,.png,.webp,.avif,.jpg,.jpeg"},{default:d(()=>[l("div",ut,[r(o,{ref_key:"uploadId",ref:T,style:{"font-size":"24px"},type:"primary",round:"",size:"large",icon:W(re)},{default:d(()=>[p("上传多个图片")]),_:1},8,["icon"]),rt])]),_:1})])],512),[[h,P.value]]),m(l("div",dt,[l("div",ct,[r(se,{data:a.value,height:"600"},{default:d(()=>[r(c,{label:"文件名","min-width":"140"},{default:d(s=>[r(v,{effect:"light",trigger:"hover",placement:"right",width:"auto"},{default:d(()=>[l("div",null,g(s.row.name),1)]),reference:d(()=>[l("span",vt,g(s.row.name),1)]),_:2},1024)]),_:1}),r(c,{label:"原尺寸","min-width":"120"},{default:d(s=>[l("div",mt,[m(l("span",null,"-",512),[[h,!s.row.originalImageWidth]]),m(l("span",{style:{"font-size":"12px"}},g(s.row.originalImageWidth)+"x"+g(s.row.originalImageHeight)+"px | "+g(oe(s.row.size)),513),[[h,s.row.originalImageWidth]])])]),_:1}),r(c,{label:"处理后尺寸","min-width":"120"},{default:d(s=>[l("div",ht,[m(l("span",null,"-",512),[[h,!s.row.isSuccess]]),m(l("span",{style:{"font-size":"12px"}},g(s.row.originalImageWidth*s.row.sizeRadio)+"x"+g(s.row.originalImageHeight*s.row.sizeRadio)+"px | "+g(s.row.compressSize),513),[[h,s.row.isSuccess]])])]),_:1}),r(c,{label:"耗时","min-width":"100"},{default:d(s=>[l("div",pt,[m(l("span",null,"-",512),[[h,!s.row.isSuccess]]),m(l("span",null,g(s.row.costNum)+"秒",513),[[h,s.row.isSuccess]])])]),_:1}),r(c,{align:"right","min-width":"120"},{header:d(()=>[l("div",gt,[r(o,{type:"",text:"",onClick:we,icon:W(re)},{default:d(()=>[p("添加更多图片")]),_:1},8,["icon"])])]),default:d(s=>[m(l("span",_t,[r(I,{percentage:s.row.progressRate},null,8,["percentage"])],512),[[h,!s.row.isSuccess]]),m(r(o,{size:"small",onClick:Ue=>ze(s.$index,s.row)},{default:d(()=>[p("查看")]),_:2},1032,["onClick"]),[[h,s.row.isSuccess]]),m(r(o,{size:"small",type:"danger",onClick:Ue=>Ee(s.$index,s.row)},{default:d(()=>[p("下载")]),_:2},1032,["onClick"]),[[h,s.row.isSuccess]])]),_:1})]),_:1},8,["data"])]),r(Be,null,{default:d(()=>[l("div",ft,[l("div",wt,[r(ke,{shadow:"always"},{default:d(()=>[r(ne,{"active-text":"尺寸",disabled:"",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s)},null,8,["modelValue"]),m(l("div",bt,[r(ie,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=s=>j.value=s)},{default:d(()=>[r(z,{label:"2"},{default:d(()=>[p("2倍")]),_:1}),r(z,{label:"4"},{default:d(()=>[p("4倍")]),_:1})]),_:1},8,["modelValue"])],512),[[h,b.value]]),r(ne,{"active-text":"画质",disabled:"",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s)},null,8,["modelValue"]),m(l("div",yt,[r(ie,{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=s=>A.value=s)},{default:d(()=>[r(z,{label:"-1"},{default:d(()=>[p("保守")]),_:1}),r(z,{label:"0"},{default:d(()=>[p("平衡")]),_:1}),r(z,{label:"3"},{default:d(()=>[p("高级")]),_:1})]),_:1},8,["modelValue"])],512),[[h,b.value]]),xt,r(o,{onClick:be,disabled:x.value,type:"success",style:{width:"100%"},size:"large"},{default:d(()=>[p("开始处理"),r(ue,{class:"el-icon--right"},{default:d(()=>[r(W(Te))]),_:1})]),_:1},8,["disabled"]),Et,It,r(o,{onClick:Ce,disabled:x.value,type:"primary",style:{width:"100%"},size:"large"},{default:d(()=>[p("打包下载 "),r(ue,{class:"el-icon--right"},{default:d(()=>[r(W(Fe))]),_:1})]),_:1},8,["disabled"])]),_:1})])])]),_:1})],512),[[h,!P.value]])]),r(Se,{"open-delay":"","append-to-body":"",modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=s=>D.value=s),width:O.value,"align-center":"",center:""},{default:d(()=>[l("div",zt,[l("div",{id:"one",style:M({height:f.value+"px",width:w.value}),class:"bal-container"},[l("div",{style:M({height:f.value+"px",width:w.value}),class:"bal-after"},[l("img",{src:$.value},null,8,Ct),Rt],4),l("div",kt,[l("div",{style:M({height:f.value+"px",width:w.value}),class:"bal-before-inset"},[l("img",{id:"afterImageId",src:F.value},null,8,Bt),St],4)]),Ut],4)])]),_:1},8,["modelValue","width"]),Vt],64)}}});const va=at(Wt,[["__scopeId","data-v-87114bc5"]]);export{va as default};
