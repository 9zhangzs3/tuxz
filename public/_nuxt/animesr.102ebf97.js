import{E as We}from"./index.f74eccca.js";import{E as Pe,a as Ve}from"./el-progress.dc5687d2.js";import{B as De,E as Ue,a as Oe,b as Ae}from"./beforafter.cc9044ff.js";import{E as He}from"./el-switch.50da660a.js";import{E as Le,a as Me}from"./el-radio-group.1be98731.js";import{E as Ne,p as ue,d as Te,a as Fe}from"./constants.0fb4eb89.js";import{E as $e}from"./el-card.a1e9063b.js";import{_ as je}from"./client-only.c15d5ece.js";import{E as Ge}from"./el-overlay.33123db5.js";import"./base.e040b817.js";/* empty css                  *//* empty css                   */import"./el-scrollbar.41fb776b.js";/* empty css                */import"./el-loading.764bfe53.js";import{d as Je,r as i,o as Ke,k as Ze,l as qe,m as l,z as m,A as p,q as u,s as r,B as V,v as h,t as g,C as N,F as Qe,D as Xe,x as Ye,y as et,_ as tt}from"./entry.b15f9cd9.js";import{J as at,F as lt}from"./FileSaver.min.8ad78cd6.js";import{E as T}from"./index.2636c4c6.js";import"./index.fb1b8b13.js";import"./use-global-config.55fa202e.js";import"./use-form-common-props.5502e3a8.js";import"./index.f8748455.js";import"./error.78e43d3e.js";import"./index.600d1f4a.js";import"./aria.60e0cdc6.js";import"./focus-trap.8efa8190.js";import"./_commonjsHelpers.042e6b4d.js";import"./debounce.fead197d.js";import"./event.9519ab40.js";import"./index.d4df232b.js";import"./vnode.bca66073.js";import"./scroll.e8e2652b.js";const _=R=>(Ye("data-v-5473ece8"),R=R(),et(),R),ot={style:{width:"90%",margin:"0 auto"}},st={style:{width:"60%",margin:"0 auto","margin-top":"15%"}},it=_(()=>l("div",{style:{"font-size":"24px",height:"50px"}},"动漫图片清晰度修复",-1)),nt={style:{"margin-top":"10%","font-size":"24px"}},ut=_(()=>l("div",{style:{color:"black"}},"或者拖放多个文件",-1)),rt={style:{width:"100%",margin:"0 auto","margin-top":"10%"}},dt={style:{float:"left",height:"500px",width:"70%"}},ct={style:{overflow:"hidden",display:"inline-block","max-width":"180px","white-space":"nowrap","text-overflow":"ellipsis",title:"center"}},vt={style:{display:"flex","align-items":"center"}},mt={style:{display:"flex","align-items":"center"}},pt={style:{display:"flex","align-items":"center"}},ht={style:{"text-align":"right"}},gt={style:{"text-align":"center"}},_t={style:{float:"right",width:"25%",height:"442px",margin:"0 auto"}},ft={style:{height:"400px","margin-top":"20px"}},wt={class:"slider-demo-block"},bt={class:"slider-demo-block"},yt=_(()=>l("div",{style:{height:"20px"}},null,-1)),xt=_(()=>l("br",null,null,-1)),Et=_(()=>l("div",{style:{height:"15px"}},null,-1)),It={class:"mainSection"},Ct=["src"],Rt=_(()=>l("div",{class:"bal-afterPosition afterLabel"},"处理后",-1)),kt={class:"bal-before"},Bt=["src"],St=_(()=>l("div",{class:"bal-beforePosition beforeLabel"},"处理前",-1)),zt=_(()=>l("div",{class:"bal-handle"},[l("span",{class:"handle-left-arrow"}),l("span",{class:"handle-right-arrow"})],-1)),Wt=_(()=>l("div",{style:{display:"none"}},[l("canvas",{id:"canvas-upload"}),l("canvas",{id:"canvas-output"})],-1)),Pt=Je({__name:"animesr",setup(R){i(!0);const D=i(!0),F=i(),a=i([]);i(73);const U=i(!1),$=i(),j=i(),f=i(0),w=i("100%"),O=i("80%"),A=i(0),k=i(),b=i(!0),H=i("2"),L=i("3"),x=i(!1);let E=null,y=null;var B=null;const G=i(0),J=i(0),M=i(),K=i(!1),Z=i(!1),re=i(50),S=i(0),q=i(0),Q=i(0),de=i(2),z=i(0),X=i(0),Y=i(0),ee=i(-1),te=i(0),ae=i(!0),W=i(),n=i(0);Ke(function(){B={print:t=>{console.log("print",t),t.length>11&&t.substring(0,10)==="$CALLBACK$"&&me(t.substring(11,t.length))},printErr:t=>{console.log("err",t)}},ge()});const P=t=>{let e=document.getElementById("canvas-upload"),o=e.getContext("2d"),c=new FileReader;c.onload=v=>{let d=new Image;d.onload=()=>{e.width=d.width,e.height=d.height,o.drawImage(d,0,0),G.value=d.width,J.value=d.height,a.value[n.value].originalImageWidth||(a.value[n.value].originalImageWidth=d.width,a.value[n.value].originalImageHeight=d.height),a.value[n.value].beforeImageWidth=d.width,a.value[n.value].beforeImageHeight=d.height,a.value[n.value].sizeRadio=H.value,a.value[n.value].isSuccess=!1;let I=o.getImageData(0,0,e.width,e.height);ce(I,e.width,e.height)},d.src=v.target.result},c.readAsDataURL(t)},ce=(t,e,o)=>{let c=document.getElementById("canvas-output");c.getContext("2d"),M.value="启动中，预计10秒内完成耗时估算...",K.value=!0,Z.value=!1,re.value=50,S.value=0,q.value=0,Q.value=0,ee.value=L.value,z.value=de.value,te.value=ee.value,X.value=G.value*z.value,Y.value=J.value*z.value,c.width=X.value,c.height=Y.value;let v=document.getElementById("canvas-output"),d=v.getContext("2d");E=_malloc(t.data.length),HEAPU8.set(t.data,E);let I=d.getImageData(0,0,v.width,v.height);y=_malloc(I.data.length),_process_image(0,E,y,e,o,z.value,te.value)!==0&&console.log("请稍后再试,调用冲突")},ve=()=>ae.value?!1:(console.log("正在努力加载资源中(约12MB)，请稍后再试"),!0),me=t=>{try{let e=JSON.parse(t);switch(e.eventType){case"PROC_END":he(e.cost);break;case"PROC_PROGRESS":pe(e.total_cost,e.tile_cost,e.progress_rate,e.remaining_time)}}catch(e){console.error("wasmCallback parse error:",e)}},pe=(t,e,o,c)=>{M.value="本地CPU努力处理中......",S.value=Math.ceil(o*50),a.value[n.value].reReal?a.value[n.value].progressRate=50+S.value:a.value[n.value].progressRate=S.value,q.value=t,Q.value=Math.round(c/1e3)},he=t=>{let e=document.getElementById("canvas-output"),o=e.getContext("2d");a.value[n.value].imageWidth=e.width,a.value[n.value].imageHeight=e.height;let c=o.getImageData(0,0,e.width,e.height),v=HEAPU8.subarray(y,y+c.data.length);c.data.set(v),o.putImageData(c,0,0),W.value=e.toDataURL(),a.value[n.value].compressBase64=W.value,a.value[n.value].compressSize=le(W.value.length),a.value[n.value].handleBlob=be(W.value),a.value[n.value].afterUrl=ye(a.value[n.value].handleBlob),_free(E),_free(y),E=null,y=null,K.value=!1,Z.value=!0;let d=Math.round(t/1e3);t<1e3&&(d=(t/1e3).toFixed(2)),M.value="处理完成！耗时: "+d+"秒",a.value[n.value].costNum+=d,a.value[n.value].sizeRadio=="4"&&a.value[n.value].originalImageWidth*a.value[n.value].sizeRadio>e.width?(a.value[n.value].reReal=!0,P(a.value[n.value].handleBlob)):(a.value[n.value].isSuccess=!0,n.value++,n.value<=a.value.length-1?P(a.value[n.value].raw):x.value=!1)},ge=()=>{fetch("../wasm/realcugan-ncnn-webassembly-simd-threads.wasm").then(t=>{t.arrayBuffer()}).then(t=>{B.wasmBinary=t;let e=document.createElement("script");e.src="../worker/initRealCuganModule.js",e.onload=()=>{setModule(B);let o=document.createElement("script");o.src="../worker/realcugan-ncnn-webassembly-simd-threads.js",o.onload=()=>{console.log("Emscripten loaded.")},document.body.appendChild(o)},document.body.appendChild(e),B.onRuntimeInitialized=()=>{console.log("wasm module loaded"),ae.value=!0}})},_e=async(t,e)=>{k.value||(k.value=T.service({lock:!0,text:"正在加载图片...",background:"rgba(0, 0, 0, 0.7)"}));let o=e.length;A.value=Math.max(o,A.value),setTimeout(()=>{if(o===A.value){D.value=!1;for(let c=a.value.length;c<e.length;c++)t=e[c],Ee.value+=t.size,a.value.push({url:t.url,name:t.raw.name,size:t.size,raw:t.raw,type:t.raw.type,compressSize:"-",index:a.value.length-1,flag:!1,costNum:0});k.value.close(),k.value=null}},1)},le=function(t){var e="";t<.1*1024?e=t.toFixed(2)+" B":t<.1*1024*1024?e=(t/1024).toFixed(2)+" KB":t<.1*1024*1024*1024?e=(t/(1024*1024)).toFixed(2)+" MB":e=(t/(1024*1024*1024)).toFixed(2)+" GB";var o=e+"",c=o.indexOf("."),v=o.substr(c+1,2);return v=="00"?o.substring(0,c)+o.substr(c+3,2):o},fe=()=>{var t,e;(e=(t=F.value)==null?void 0:t.$.vnode.el)==null||e.click()};async function we(){if(ve()){console.log("未准备好");return}n.value=0;for(let e=0;e<a.value.length;e++)a.value[e].isSuccess=!1,a.value[e].reReal=!1,a.value[e].progressRate=0,a.value[e].costNum=0;const t=T.service({lock:!0,background:"rgba(0, 0, 0, 0.7)"});t.setText("0/"+a.value.length),x.value=!0,P(a.value[n.value].raw),t.close()}function be(t){for(var e=t.split(","),o=e[0].match(/:(.*?);/)[1],c=atob(e[1]),v=c.length,d=new Uint8Array(v);v--;)d[v]=c.charCodeAt(v);return new Blob([d],{type:o})}function ye(t){return window.URL.createObjectURL(t)}const xe=t=>{const e=document.createElement("a");e.href=a.value[t].compressBase64,e.download=a.value[t].name,e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),setTimeout(()=>{e.remove()},100)},Ee=i(0),Ie=t=>{U.value=!0,f.value=0,O.value="80%",Xe(()=>{new De({id:"#one"}),w.value="100%",$.value=a.value[t].url,j.value=a.value[t].afterUrl;let e=document.getElementsByClassName("mainSection")[0];if(a.value[t].imageWidth<e.offsetWidth)f.value=a.value[t].imageHeight,w.value=a.value[t].imageWidth+"px",O.value=a.value[t].imageWidth+50+"px";else{let o=e.offsetWidth*(a.value[t].imageHeight/a.value[t].imageWidth);f.value=o,w.value=e.offsetWidth+"px"}})},Ce=()=>{if(a.value.length==0)return;const t=T.service({lock:!0,text:"正在打包...",background:"rgba(0, 0, 0, 0.7)"});let e=new at;for(let o=0;o<a.value.length;o++)e.file(a.value[o].name,Re(a.value[o].compressBase64),{base64:!0});e.generateAsync({type:"blob"}).then(function(o){lt.saveAs(o,"图片.zip")}),t.close()},Re=t=>{var e=t.split(",");return e[1]};return(t,e)=>{const o=We,c=Pe,v=Ue,d=Oe,I=Ve,oe=Ae,se=He,C=Le,ie=Me,ne=Ne,ke=$e,Be=je,Se=Ge;return Ze(),qe(Qe,null,[l("div",ot,[m(l("div",st,[it,l("div",null,[u(c,{class:"upload-demo",drag:"","list-type":"picture-card","show-file-list":!1,"auto-upload":!1,onChange:_e,multiple:"true",accept:".gif,.png,.webp,.avif,.jpg,.jpeg"},{default:r(()=>[l("div",nt,[u(o,{ref_key:"uploadId",ref:F,style:{"font-size":"24px"},type:"primary",round:"",size:"large",icon:V(ue)},{default:r(()=>[h("上传多个图片")]),_:1},8,["icon"]),ut])]),_:1})])],512),[[p,D.value]]),m(l("div",rt,[l("div",dt,[u(oe,{data:a.value,height:"600"},{default:r(()=>[u(d,{label:"文件名","min-width":"140"},{default:r(s=>[u(v,{effect:"light",trigger:"hover",placement:"right",width:"auto"},{default:r(()=>[l("div",null,g(s.row.name),1)]),reference:r(()=>[l("span",ct,g(s.row.name),1)]),_:2},1024)]),_:1}),u(d,{label:"原尺寸","min-width":"120"},{default:r(s=>[l("div",vt,[m(l("span",null,"-",512),[[p,!s.row.originalImageWidth]]),m(l("span",{style:{"font-size":"12px"}},g(s.row.originalImageWidth)+"x"+g(s.row.originalImageHeight)+"px | "+g(le(s.row.size)),513),[[p,s.row.originalImageWidth]])])]),_:1}),u(d,{label:"处理后尺寸","min-width":"120"},{default:r(s=>[l("div",mt,[m(l("span",null,"-",512),[[p,!s.row.isSuccess]]),m(l("span",{style:{"font-size":"12px"}},g(s.row.originalImageWidth*s.row.sizeRadio)+"x"+g(s.row.originalImageHeight*s.row.sizeRadio)+"px | "+g(s.row.compressSize),513),[[p,s.row.isSuccess]])])]),_:1}),u(d,{label:"耗时","min-width":"100"},{default:r(s=>[l("div",pt,[m(l("span",null,"-",512),[[p,!s.row.isSuccess]]),m(l("span",null,g(s.row.costNum)+"秒",513),[[p,s.row.isSuccess]])])]),_:1}),u(d,{align:"right","min-width":"120"},{header:r(()=>[l("div",ht,[u(o,{type:"",text:"",onClick:fe,icon:V(ue)},{default:r(()=>[h("添加更多图片")]),_:1},8,["icon"])])]),default:r(s=>[m(l("span",gt,[u(I,{percentage:s.row.progressRate},null,8,["percentage"])],512),[[p,!s.row.isSuccess]]),m(u(o,{size:"small",onClick:ze=>Ie(s.$index,s.row)},{default:r(()=>[h("查看")]),_:2},1032,["onClick"]),[[p,s.row.isSuccess]]),m(u(o,{size:"small",type:"danger",onClick:ze=>xe(s.$index,s.row)},{default:r(()=>[h("下载")]),_:2},1032,["onClick"]),[[p,s.row.isSuccess]])]),_:1})]),_:1},8,["data"])]),u(Be,null,{default:r(()=>[l("div",_t,[l("div",ft,[u(ke,{shadow:"always"},{default:r(()=>[u(se,{"active-text":"尺寸",disabled:"",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s)},null,8,["modelValue"]),m(l("div",wt,[u(ie,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=s=>H.value=s)},{default:r(()=>[u(C,{label:"2"},{default:r(()=>[h("2倍")]),_:1}),u(C,{label:"4"},{default:r(()=>[h("4倍")]),_:1})]),_:1},8,["modelValue"])],512),[[p,b.value]]),u(se,{"active-text":"画质",disabled:"",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s)},null,8,["modelValue"]),m(l("div",bt,[u(ie,{modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=s=>L.value=s)},{default:r(()=>[u(C,{label:"-1"},{default:r(()=>[h("保守")]),_:1}),u(C,{label:"0"},{default:r(()=>[h("平衡")]),_:1}),u(C,{label:"3"},{default:r(()=>[h("高级")]),_:1})]),_:1},8,["modelValue"])],512),[[p,b.value]]),yt,u(o,{onClick:we,disabled:x.value,type:"success",style:{width:"100%"},size:"large"},{default:r(()=>[h("开始处理"),u(ne,{class:"el-icon--right"},{default:r(()=>[u(V(Te))]),_:1})]),_:1},8,["disabled"]),xt,Et,u(o,{onClick:Ce,disabled:x.value,type:"primary",style:{width:"100%"},size:"large"},{default:r(()=>[h("打包下载 "),u(ne,{class:"el-icon--right"},{default:r(()=>[u(V(Fe))]),_:1})]),_:1},8,["disabled"])]),_:1})])])]),_:1})],512),[[p,!D.value]])]),u(Se,{"open-delay":"","append-to-body":"",modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=s=>U.value=s),width:O.value,"align-center":"",center:""},{default:r(()=>[l("div",It,[l("div",{id:"one",style:N({height:f.value+"px",width:w.value}),class:"bal-container"},[l("div",{style:N({height:f.value+"px",width:w.value}),class:"bal-after"},[l("img",{src:j.value},null,8,Ct),Rt],4),l("div",kt,[l("div",{style:N({height:f.value+"px",width:w.value}),class:"bal-before-inset"},[l("img",{id:"afterImageId",src:$.value},null,8,Bt),St],4)]),zt],4)])]),_:1},8,["modelValue","width"]),Wt],64)}}});const ca=tt(Pt,[["__scopeId","data-v-5473ece8"]]);export{ca as default};
