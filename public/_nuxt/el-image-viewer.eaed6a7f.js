import{C as be,D as _e,E as O,A as Ie,y as ze,l as Le,s as Ee,z as Ce,n as xe,o as Se,c as B,i as X,F as Ne}from"./constants.32292d8d.js";import{d as U,ai as fe,J as ve,r as h,aj as Oe,ag as Te,c as f,M as re,D as me,o as pe,k as w,E as ie,q as u,s as I,m as g,L as c,B as t,C as ue,aa as Ae,S as z,l as S,F as Q,R as $e,H as Re,z as Ve,A as Be,Q as J,T as Me,ak as De,al as Ye,t as Fe,a2 as Xe,V as Pe}from"./entry.1dc6e359.js";import{b as ge,d as ce,m as we,i as de,_ as ye,w as ke,g as He}from"./base.c3d2e3d9.js";import{i as je,r as he,w as Ke}from"./use-form-common-props.197ce949.js";import{u as We}from"./index.901f8d30.js";import{E as V}from"./aria.60e0cdc6.js";import{d as Ze}from"./debounce.72c54a3b.js";import{u as qe}from"./index.ca35bea9.js";import{i as Ge}from"./position.7b373cbe.js";import{g as Je}from"./scroll.9c3d5e4c.js";var Qe="Expected a function";function le(d,b,r){var s=!0,y=!0;if(typeof d!="function")throw new TypeError(Qe);return je(r)&&(s="leading"in r?!!r.leading:s,y="trailing"in r?!!r.trailing:y),Ze(d,b,{leading:s,maxWait:b,trailing:y})}const Ue=ge({urlList:{type:ce(Array),default:()=>we([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),ea={close:()=>!0,switch:d=>de(d)},aa=["src"],ta=U({name:"ElImageViewer"}),na=U({...ta,props:Ue,emits:ea,setup(d,{expose:b,emit:r}){const s=d,y={CONTAIN:{name:"contain",icon:fe(be)},ORIGINAL:{name:"original",icon:fe(_e)}},{t:L}=he(),l=ve("image-viewer"),{nextZIndex:ee}=We(),T=h(),N=h([]),E=Oe(),_=h(!0),v=h(s.initialIndex),m=Te(y.CONTAIN),i=h({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=f(()=>{const{urlList:e}=s;return e.length<=1}),$=f(()=>v.value===0),P=f(()=>v.value===s.urlList.length-1),ae=f(()=>s.urlList[v.value]),te=f(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!s.infinite&&$.value)]),D=f(()=>[l.e("btn"),l.e("next"),l.is("disabled",!s.infinite&&P.value)]),ne=f(()=>{const{scale:e,deg:n,offsetX:o,offsetY:p,enableTransition:C}=i.value;let k=o/e,x=p/e;switch(n%360){case 90:case-270:[k,x]=[x,-k];break;case 180:case-180:[k,x]=[-k,-x];break;case 270:case-90:[k,x]=[-x,k];break}const R={transform:`scale(${e}) rotate(${n}deg) translate(${k}px, ${x}px)`,transition:C?"transform .3s":""};return m.value.name===y.CONTAIN.name&&(R.maxWidth=R.maxHeight="100%"),R}),H=f(()=>de(s.zIndex)?s.zIndex:ee());function A(){oe(),r("close")}function se(){const e=le(o=>{switch(o.code){case V.esc:s.closeOnPressEscape&&A();break;case V.space:Z();break;case V.left:q();break;case V.up:a("zoomIn");break;case V.right:G();break;case V.down:a("zoomOut");break}}),n=le(o=>{const p=o.deltaY||o.deltaX;a(p<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});E.run(()=>{B(document,"keydown",e),B(document,"wheel",n)})}function oe(){E.stop()}function j(){_.value=!1}function K(e){_.value=!1,e.target.alt=L("el.image.error")}function W(e){if(_.value||e.button!==0||!T.value)return;i.value.enableTransition=!1;const{offsetX:n,offsetY:o}=i.value,p=e.pageX,C=e.pageY,k=le(R=>{i.value={...i.value,offsetX:n+R.pageX-p,offsetY:o+R.pageY-C}}),x=B(document,"mousemove",k);B(document,"mouseup",()=>{x()}),e.preventDefault()}function Y(){i.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Z(){if(_.value)return;const e=Ke(y),n=Object.values(y),o=m.value.name,C=(n.findIndex(k=>k.name===o)+1)%e.length;m.value=y[e[C]],Y()}function F(e){const n=s.urlList.length;v.value=(e+n)%n}function q(){$.value&&!s.infinite||F(v.value-1)}function G(){P.value&&!s.infinite||F(v.value+1)}function a(e,n={}){if(_.value)return;const{zoomRate:o,rotateDeg:p,enableTransition:C}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":i.value.scale>.2&&(i.value.scale=Number.parseFloat((i.value.scale/o).toFixed(3)));break;case"zoomIn":i.value.scale<7&&(i.value.scale=Number.parseFloat((i.value.scale*o).toFixed(3)));break;case"clockwise":i.value.deg+=p;break;case"anticlockwise":i.value.deg-=p;break}i.value.enableTransition=C}return re(ae,()=>{me(()=>{const e=N.value[0];e!=null&&e.complete||(_.value=!0)})}),re(v,e=>{Y(),r("switch",e)}),pe(()=>{var e,n;se(),(n=(e=T.value)==null?void 0:e.focus)==null||n.call(e)}),b({setActiveItem:F}),(e,n)=>(w(),ie(De,{to:"body",disabled:!e.teleported},[u(Me,{name:"viewer-fade",appear:""},{default:I(()=>[g("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:c(t(l).e("wrapper")),style:ue({zIndex:t(H)})},[g("div",{class:c(t(l).e("mask")),onClick:n[0]||(n[0]=Ae(o=>e.hideOnClickModal&&A(),["self"]))},null,2),z(" CLOSE "),g("span",{class:c([t(l).e("btn"),t(l).e("close")]),onClick:A},[u(t(O),null,{default:I(()=>[u(t(Ie))]),_:1})],2),z(" ARROW "),t(M)?z("v-if",!0):(w(),S(Q,{key:0},[g("span",{class:c(t(te)),onClick:q},[u(t(O),null,{default:I(()=>[u(t(ze))]),_:1})],2),g("span",{class:c(t(D)),onClick:G},[u(t(O),null,{default:I(()=>[u(t(Le))]),_:1})],2)],64)),z(" ACTIONS "),g("div",{class:c([t(l).e("btn"),t(l).e("actions")])},[g("div",{class:c(t(l).e("actions__inner"))},[u(t(O),{onClick:n[1]||(n[1]=o=>a("zoomOut"))},{default:I(()=>[u(t(Ee))]),_:1}),u(t(O),{onClick:n[2]||(n[2]=o=>a("zoomIn"))},{default:I(()=>[u(t(Ce))]),_:1}),g("i",{class:c(t(l).e("actions__divider"))},null,2),u(t(O),{onClick:Z},{default:I(()=>[(w(),ie($e(t(m).icon)))]),_:1}),g("i",{class:c(t(l).e("actions__divider"))},null,2),u(t(O),{onClick:n[3]||(n[3]=o=>a("anticlockwise"))},{default:I(()=>[u(t(xe))]),_:1}),u(t(O),{onClick:n[4]||(n[4]=o=>a("clockwise"))},{default:I(()=>[u(t(Se))]),_:1})],2)],2),z(" CANVAS "),g("div",{class:c(t(l).e("canvas"))},[(w(!0),S(Q,null,Re(e.urlList,(o,p)=>Ve((w(),S("img",{ref_for:!0,ref:C=>N.value[p]=C,key:o,src:o,style:ue(t(ne)),class:c(t(l).e("img")),onLoad:j,onError:K,onMousedown:W},null,46,aa)),[[Be,p===v.value]])),128))],2),J(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var sa=ye(na,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const oa=ke(sa),la=ge({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ce([String,Object])},previewSrcList:{type:ce(Array),default:()=>we([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),ra={load:d=>d instanceof Event,error:d=>d instanceof Event,switch:d=>de(d),close:()=>!0,show:()=>!0},ia=["src","loading"],ua={key:0},ca=U({name:"ElImage",inheritAttrs:!1}),da=U({...ca,props:la,emits:ra,setup(d,{emit:b}){const r=d;let s="";const{t:y}=he(),L=ve("image"),l=Ye(),ee=qe(),T=h(),N=h(!1),E=h(!0),_=h(!1),v=h(),m=h(),i=X&&"loading"in HTMLImageElement.prototype;let M,$;const P=f(()=>[L.e("inner"),D.value&&L.e("preview"),E.value&&L.is("loading")]),ae=f(()=>l.style),te=f(()=>{const{fit:a}=r;return X&&a?{objectFit:a}:{}}),D=f(()=>{const{previewSrcList:a}=r;return Array.isArray(a)&&a.length>0}),ne=f(()=>{const{previewSrcList:a,initialIndex:e}=r;let n=e;return e>a.length-1&&(n=0),n}),H=f(()=>r.loading==="eager"?!1:!i&&r.loading==="lazy"||r.lazy),A=()=>{X&&(E.value=!0,N.value=!1,T.value=r.src)};function se(a){E.value=!1,N.value=!1,b("load",a)}function oe(a){E.value=!1,N.value=!0,b("error",a)}function j(){Ge(v.value,m.value)&&(A(),Y())}const K=Ne(j,200,!0);async function W(){var a;if(!X)return;await me();const{scrollContainer:e}=r;He(e)?m.value=e:Pe(e)&&e!==""?m.value=(a=document.querySelector(e))!=null?a:void 0:v.value&&(m.value=Je(v.value)),m.value&&(M=B(m,"scroll",K),setTimeout(()=>j(),100))}function Y(){!X||!m.value||!K||(M==null||M(),m.value=void 0)}function Z(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function F(){D.value&&($=B("wheel",Z,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",_.value=!0,b("show"))}function q(){$==null||$(),document.body.style.overflow=s,_.value=!1,b("close")}function G(a){b("switch",a)}return re(()=>r.src,()=>{H.value?(E.value=!0,N.value=!1,Y(),W()):A()}),pe(()=>{H.value?W():A()}),(a,e)=>(w(),S("div",{ref_key:"container",ref:v,class:c([t(L).b(),a.$attrs.class]),style:ue(t(ae))},[N.value?J(a.$slots,"error",{key:0},()=>[g("div",{class:c(t(L).e("error"))},Fe(t(y)("el.image.error")),3)]):(w(),S(Q,{key:1},[T.value!==void 0?(w(),S("img",Xe({key:0},t(ee),{src:T.value,loading:a.loading,style:t(te),class:t(P),onClick:F,onLoad:se,onError:oe}),null,16,ia)):z("v-if",!0),E.value?(w(),S("div",{key:1,class:c(t(L).e("wrapper"))},[J(a.$slots,"placeholder",{},()=>[g("div",{class:c(t(L).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),t(D)?(w(),S(Q,{key:2},[_.value?(w(),ie(t(oa),{key:0,"z-index":a.zIndex,"initial-index":t(ne),infinite:a.infinite,"zoom-rate":a.zoomRate,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:q,onSwitch:G},{default:I(()=>[a.$slots.viewer?(w(),S("div",ua,[J(a.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}});var fa=ye(da,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Ia=ke(fa);export{Ia as E};
